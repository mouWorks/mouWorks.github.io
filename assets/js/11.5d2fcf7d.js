(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{203:function(a,t,e){"use strict";e.r(t);var r=e(0),s=Object(r.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"php系統升級"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#php系統升級","aria-hidden":"true"}},[a._v("#")]),a._v(" Php系統升級")]),a._v(" "),e("ul",[e("li",[a._v("系統升級:  php5-> php7")]),a._v(" "),e("li",[e("code",[a._v("14.04")]),a._v(" 不支援7, 故需要\n"),e("ul",[e("li",[e("code",[a._v("14.04")]),a._v(" -> "),e("code",[a._v("16.04")]),a._v(" Ubuntu 系統升級")])])])]),a._v(" "),e("h2",{attrs:{id:"執行步驟"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#執行步驟","aria-hidden":"true"}},[a._v("#")]),a._v(" 執行步驟")]),a._v(" "),e("h3",{attrs:{id:"ubuntu-內系統-upgrade-先將系統由14-04-升到-16-04"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-內系統-upgrade-先將系統由14-04-升到-16-04","aria-hidden":"true"}},[a._v("#")]),a._v(" ubuntu 內系統 Upgrade -> 先將系統由"),e("code",[a._v("14.04")]),a._v(" 升到 "),e("code",[a._v("16.04")])]),a._v(" "),e("pre",[e("code",[a._v("```\nsudo su\napt-get update\napt-get upgrade\napt-get dist-upgrade\ndo-release-upgrade\n```\n* 指令如上, 中間會跳一些問題供選擇\n\n* 線上機器 Abort phpAdmin upgrade\n")])]),a._v(" "),e("ul",[e("li",[a._v("此時 php為7.0")]),a._v(" "),e("li",[a._v("裝完之後會有 "),e("code",[a._v("mariadb")]),a._v(" 設定的問題\n"),e("code",[a._v("Errors were encountered while processing: mariadb-server-10.0")])])]),a._v(" "),e("h3",{attrs:{id:"除錯"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#除錯","aria-hidden":"true"}},[a._v("#")]),a._v(" 除錯")]),a._v(" "),e("pre",[e("code",[a._v("* `apt-get install mysql-server` -> 改裝 mysql 看起來就會把 mariadb 刪掉\n* 需要確認到底用的是 mysql 還是 mariadb\n    * 線上機器用的是 `mariadb`\n\n* `apt-get remove mysql-server` -> 再把她移除, 會有問題\n* `apt-get install php7.1` -> 安裝相關的\n* `apt-get autoremove && apt-get autoclean` -> 資源回收\n* `apt-get install php7.1-fpm` -> 安裝 7.1 FPM\n")])]),a._v(" "),e("h3",{attrs:{id:"此時狀態為-php7-0"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#此時狀態為-php7-0","aria-hidden":"true"}},[a._v("#")]),a._v(" 此時狀態為 php7.0")]),a._v(" "),e("ul",[e("li",[a._v("升級到 7.1")]),a._v(" "),e("li",[e("code",[a._v("apt-get install php7.1")]),a._v(" "),e("ul",[e("li",[a._v("若找不到, 需要更新\n"),e("ul",[e("li",[e("code",[a._v("apt-get install software-properties-common")])]),a._v(" "),e("li",[e("code",[a._v("add-apt-repository ppa:ondrej/nginx")])])])])])]),a._v(" "),e("li",[a._v("安裝相依的套件: 看缺什麼裝什麼")])]),a._v(" "),e("pre",[e("code",[a._v("apt-get install php7.1-fpm\napt-get install php7.1-common \napt-get install php7.1-cli\napt-get install libpcre3\napt-get install mysql-server-5.7\napt-get install php7.1\n")])]),a._v(" "),e("ul",[e("li",[a._v("Mariadb 問題:\n"),e("ul",[e("li",[e("code",[a._v("Package mariadb-server-10.0 is not configured yet.")])])])]),a._v(" "),e("li",[a._v("估計需要重裝")])]),a._v(" "),e("pre",[e("code",[a._v("apt-get remove --purge mariadb-server mariadb-client\napt-get autoremove\napt-get autoclean\napt-get install mariadb-server mariadb-client\n")])]),a._v(" "),e("h3",{attrs:{id:"安裝-php7-1-fpm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安裝-php7-1-fpm","aria-hidden":"true"}},[a._v("#")]),a._v(" 安裝 php7.1-fpm")]),a._v(" "),e("pre",[e("code",[a._v("* 注意 `Nginx` 會指向新的位置\n* 原先 `fastcgi_pass 127.0.0.1:9000;`\n* 改為 `fastcgi_pass unix:/var/run/php/php7.1-fpm.sock;`\n")])]),a._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[a._v("檢查 "),e("code",[a._v("/var/log/nginx/debug.log")]),a._v(" 看哪裡會有問題")])]),a._v(" "),e("ul",[e("li",[e("p",[a._v("502 Bad Gateway -> 上面那個 "),e("code",[a._v("php7.1-fpm.sock")]),a._v(" 沒有設定好")])]),a._v(" "),e("li",[e("p",[a._v("空白頁 -> "),e("code",[a._v("sites-avaliable/PROJECT.conf")]),a._v(" 內部需要加上一行 "),e("code",[a._v("cgi_param")])])]),a._v(" "),e("li",[e("p",[e("code",[a._v("fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;")])])]),a._v(" "),e("li",[e("p",[a._v("最底下那行要補上, 白頁就消失了")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("location ~ \\.php$ {\n    include /path/to/fastcgi_params;\n    fastcgi_pass  127.0.0.1:9000;\n    fastcgi_index index.php;\n    fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;\n}\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br")])])])]),a._v(" "),e("h3",{attrs:{id:"登進去了-db卻連線不到-看起來是-curl-問題"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#登進去了-db卻連線不到-看起來是-curl-問題","aria-hidden":"true"}},[a._v("#")]),a._v(" 登進去了, DB卻連線不到: 看起來是 Curl 問題")]),a._v(" "),e("pre",[e("code",[a._v('`fastCGI sent in stderr: "PHP message: PHP Fatal error:  Un\n')])]),a._v(" "),e("p",[a._v("caught ErrorException: cURL library is not loaded in /home/ubuntu/PROJECT/vendor/php-curl-class/php-curl-cl\nass/src/Curl/Curl.php:103`")]),a._v(" "),e("ul",[e("li",[a._v("重裝 curl\n"),e("ul",[e("li",[e("code",[a._v("sudo apt-get update && sudo apt-get install curl")])]),a._v(" "),e("li",[e("code",[a._v("sudo apt-get install php7.1-curl")])])])]),a._v(" "),e("li",[a._v("重啟 Nginx\n"),e("ul",[e("li",[e("code",[a._v("/etc/init.d/nginx restart")])])])])]),a._v(" "),e("h3",{attrs:{id:"update"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#update","aria-hidden":"true"}},[a._v("#")]),a._v(" Update")]),a._v(" "),e("ul",[e("li",[a._v("圖片上傳失敗問題\n"),e("ul",[e("li",[a._v("要裝 php-gd\n"),e("ul",[e("li",[e("code",[a._v("sudo apt-get install php7.1-gd")])]),a._v(" "),e("li",[e("code",[a._v("/etc/init.d/nginx restart")])])])])])])]),a._v(" "),e("h3",{attrs:{id:"issue-in-production"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#issue-in-production","aria-hidden":"true"}},[a._v("#")]),a._v(" Issue in production")]),a._v(" "),e("ul",[e("li",[a._v("線上 mysqli 連不到的問題\n"),e("ul",[e("li",[a._v("ubuntu 要裝 "),e("code",[a._v("php-mysql")]),a._v(" "),e("ul",[e("li",[e("code",[a._v("apt-get install php7.1-mysqli")]),a._v(" (php 7.1 的版本)")])])])])])]),a._v(" "),e("h3",{attrs:{id:"結論"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#結論","aria-hidden":"true"}},[a._v("#")]),a._v(" 結論:")]),a._v(" "),e("ul",[e("li",[a._v("主要幾個需要重裝的")]),a._v(" "),e("li",[e("code",[a._v("apt-get install php7.1-mysqli")]),a._v(" (php 7.1 的版本) - 資料庫才能正確連接")]),a._v(" "),e("li",[e("code",[a._v("apt-get install php7.1-gd")]),a._v(" (圖片上傳功能) - php7.1-gd 需要重裝")]),a._v(" "),e("li",[e("code",[a._v("apt-get install php7.1-curl")]),a._v(" CURL 連接問題 - php7.1-curl 要裝")]),a._v(" "),e("li",[e("code",[a._v("apt-get install php7.1-fpm")]),a._v(" FPM 相關 - 裝完要設定")]),a._v(" "),e("li",[e("code",[a._v("apt-get install php7.1-mbstring")]),a._v(" 否則點進去會看不到文章")])]),a._v(" "),e("h4",{attrs:{id:"幾個可能要注意的點"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#幾個可能要注意的點","aria-hidden":"true"}},[a._v("#")]),a._v(" 幾個可能要注意的點:")]),a._v(" "),e("ul",[e("li",[e("code",[a._v("sudo apt-get upgrade")]),a._v(" 升級當下系統可能會很慢, loading 飆高")])])])}),[],!1,null,null,null);t.default=s.exports}}]);