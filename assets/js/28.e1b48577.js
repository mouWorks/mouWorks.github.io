(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{442:function(e,a,s){"use strict";s.r(a);var l=s(62),t=Object(l.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"k8s-workshop"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s-workshop"}},[e._v("#")]),e._v(" k8s Workshop")]),e._v(" "),s("ul",[s("li",[e._v("GoogleCloudSummit @ 2019/9/23")])]),e._v(" "),s("h3",{attrs:{id:"簡單實作一個docker-的-web-app-docker-w-python"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#簡單實作一個docker-的-web-app-docker-w-python"}},[e._v("#")]),e._v(" 簡單實作一個Docker 的 Web App (Docker w/Python)")]),e._v(" "),s("h4",{attrs:{id:"docker-練習"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-練習"}},[e._v("#")]),e._v(" Docker 練習")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("GCP 相關")])]),e._v(" "),s("li",[s("p",[e._v("取得 GCP project name")])])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("export GCP_PROJECT=`gcloud config list core/project --format='value(core.project)'`\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("設定好權限")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("PATH=/usr/lib/google-cloud-sdk/bin:$PATH\ngcloud auth configure-docker\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("ul",[s("li",[e._v("將build好的 container 推到 GCR (需要先設定好權限)")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("docker push gcr.io/${GCP_PROJECT}/py-web-server:v1\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("上傳完畢, 用指令去調整 GCR上面 container 的權限")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("gsutil defacl ch -u AllUsers:R gs://artifacts.${GCP_PROJECT}.appspot.com\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"遠端直接用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#遠端直接用"}},[e._v("#")]),e._v(" 遠端直接用")]),e._v(" "),s("ul",[s("li",[e._v("當你的GCR Container 設定好可外部存取時, 就可以直接On起來啟動.")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("docker run -d -p 8888:8888 -h my-web-server gcr.io/${GCP_PROJECT}/py-web-server:v1\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h3",{attrs:{id:"k8s-基礎介紹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s-基礎介紹"}},[e._v("#")]),e._v(" k8s 基礎介紹")]),e._v(" "),s("ul",[s("li",[e._v("Google Cloud Run")]),e._v(" "),s("li",[e._v("k8s 需要架設 Cluster")]),e._v(" "),s("li",[e._v("GKE: google k8s + Google Cloud run")])]),e._v(" "),s("h4",{attrs:{id:"cluster-定義"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cluster-定義"}},[e._v("#")]),e._v(" Cluster 定義")]),e._v(" "),s("ul",[s("li",[e._v("必有 Master 和 其他 node 節點 (worker) -  Google 管理 Master 節點")])]),e._v(" "),s("h4",{attrs:{id:"how-k8s-work"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-k8s-work"}},[e._v("#")]),e._v(" How K8s work")]),e._v(" "),s("ul",[s("li",[e._v("k8s 管理 job, job 在node上面跑 container")]),e._v(" "),s("li",[e._v("實際情況: 一個 cluster 內 node 可能上千")]),e._v(" "),s("li",[e._v("job被稱為 "),s("code",[e._v("pod")])]),e._v(" "),s("li",[e._v("pod 分享 "),s("code",[e._v("network")]),e._v(" 和 "),s("code",[e._v("storage")])]),e._v(" "),s("li",[e._v("單一最小服務個體(欲取代VM單位)")]),e._v(" "),s("li",[e._v("一個 module 可能會有多個 container, 避免 "),s("code",[e._v("FatContainer")]),e._v(" 設計")]),e._v(" "),s("li",[e._v("AutoScaling 單位: "),s("code",[e._v("pod")])]),e._v(" "),s("li",[e._v("每一個單一的Pod 都會有自己的IP (uniqueIP)")]),e._v(" "),s("li",[e._v("GKE 在pod內使用 iptables 做 port forwarding")])]),e._v(" "),s("h4",{attrs:{id:"pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pod"}},[e._v("#")]),e._v(" pod")]),e._v(" "),s("ul",[s("li",[e._v("獨立 yaml 定義 : "),s("code",[e._v("pod.yaml")])]),e._v(" "),s("li",[e._v("有些類似 docker-compose 寫法.")]),e._v(" "),s("li",[e._v("可以定義 如何建立多個 container, 並且互相連結.")]),e._v(" "),s("li",[e._v("pod.yaml 檔案給 master 讀取.")]),e._v(" "),s("li",[e._v("master 節點會在node上面分配並且建立 pods")])]),e._v(" "),s("h4",{attrs:{id:"deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deployment"}},[e._v("#")]),e._v(" Deployment")]),e._v(" "),s("ul",[s("li",[e._v("獨立 yaml 定義 : "),s("code",[e._v("deployment.yaml")])]),e._v(" "),s("li",[e._v("確保我的節點上面要跑多少個 pod")]),e._v(" "),s("li",[s("code",[e._v("replicas")]),e._v(" : 要跑幾個pod")])]),e._v(" "),s("h4",{attrs:{id:"service層"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service層"}},[e._v("#")]),e._v(" Service層")]),e._v(" "),s("ul",[s("li",[e._v("獨立 yaml 定義 : "),s("code",[e._v("service.yaml")])]),e._v(" "),s("li",[e._v("Request 進入Service, 固定ip位置")]),e._v(" "),s("li",[e._v("Decoupling system -> 方便分別 scaling")]),e._v(" "),s("li",[e._v("Google 有三種:\n"),s("ul",[s("li",[s("code",[e._v("serviceIp")]),e._v(" -> 一個外部ip固定給別人打")]),e._v(" "),s("li",[s("code",[e._v("loadbalancer")])]),e._v(" "),s("li",[s("code",[e._v("TBD")])])])])]),e._v(" "),s("h4",{attrs:{id:"label"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#label"}},[e._v("#")]),e._v(" label")]),e._v(" "),s("ul",[s("li",[e._v("類似打 Tag")]),e._v(" "),s("li",[e._v("Metadata 可以 assign Api物件上去")]),e._v(" "),s("li",[e._v("pods使用 labels 來做 grouping")]),e._v(" "),s("li",[e._v("Selector 可以用來 search 他們")])]),e._v(" "),s("h4",{attrs:{id:"kubelets"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubelets"}},[e._v("#")]),e._v(" Kubelets")]),e._v(" "),s("ul",[s("li",[e._v("會檢查pod是否 healthy")]),e._v(" "),s("li",[e._v("unhealthy -> 重開pod(秒級,速度極快)")])]),e._v(" "),s("h4",{attrs:{id:"volumes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#volumes"}},[e._v("#")]),e._v(" Volumes")]),e._v(" "),s("ul",[s("li",[e._v("volumes 不在 pod 內, 且為 stateful")]),e._v(" "),s("li",[e._v("使用者的相關資料不要存在 pod 內 -> 萬一 pod 掛掉則 使用者資料消失")]),e._v(" "),s("li",[e._v("pod is stateless (不存使用者資料)")]),e._v(" "),s("li",[e._v("volumes is stateful  (有資料)")]),e._v(" "),s("li",[e._v("kubectl 建立 volumes")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl create <volumes>\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("pod 去讀 volumes")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl create -f pod.yml \n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("幾乎不操作 node 節點")]),e._v(" "),s("li",[e._v("跟master溝通, 經由 yaml檔案來操作")])]),e._v(" "),s("h4",{attrs:{id:"k8s-部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s-部署"}},[e._v("#")]),e._v(" K8s 部署")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("deployments 和 rolling updates")])]),e._v(" "),s("li",[s("p",[e._v("建立 cluster -> "),s("code",[e._v("gcloud")])])]),e._v(" "),s("li",[s("p",[e._v("控制 -> "),s("code",[e._v("kubectl")])])]),e._v(" "),s("li",[s("p",[e._v("Cluster Scaling -> Google 的 AutoScaler")])]),e._v(" "),s("li",[s("p",[e._v("K8s Scaling -> Replica set 會去自動調整/修正")])]),e._v(" "),s("li",[s("p",[e._v("Rolling Update:")]),e._v(" "),s("ul",[s("li",[e._v("滾動式 update")]),e._v(" "),s("li",[e._v("Rollback")])])]),e._v(" "),s("li",[s("p",[s("em",[e._v("K8S強項")]),e._v(" Canary Update / Blue-green deployment:")]),e._v(" "),s("ul",[s("li",[e._v("Canary: 前期測試\n"),s("ul",[s("li",[e._v("兩組deployment, 皆同一組 service")]),e._v(" "),s("li",[e._v("可用分流, 做 a/b testing")])])]),e._v(" "),s("li",[e._v("Blue-green:\n"),s("ul",[s("li",[e._v("service 先接藍色")]),e._v(" "),s("li",[e._v("綠色 deploy 完成之後, service 切到藍色")])])])])])]),e._v(" "),s("h4",{attrs:{id:"k8s-實作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s-實作"}},[e._v("#")]),e._v(" k8s 實作")]),e._v(" "),s("ul",[s("li",[e._v("設定zone資訊(以後就不必再輸入)")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("gcloud config set compute/zone us-central1-a\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("Git clone sample 教材")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git clone https://github.com/googlecodelabs/orchestrate-with-kubernetes.git\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("建立一個5個node 的 cluster")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('gcloud container clusters create bootcamp --num-nodes 5 --scopes "https://www.googleapis.com/auth/projecthosting,storage-rw"\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"deployment-元件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deployment-元件"}},[e._v("#")]),e._v(" Deployment 元件")]),e._v(" "),s("ul",[s("li",[e._v("Explain 既有的 deployment 元件")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl explain deployment\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("加上 "),s("code",[e._v("recursive")]),e._v(" 可看到更多")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl explain deployment --recursive\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("可指定特定元素")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl explain deployment.metadata.name\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"建立-deploymnet-元件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#建立-deploymnet-元件"}},[e._v("#")]),e._v(" 建立 Deploymnet 元件")]),e._v(" "),s("ul",[s("li",[e._v("看一下撰寫的 auth.yaml")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("cat deployments/auth.yaml\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"deployment-的-scale-up-and-down"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deployment-的-scale-up-and-down"}},[e._v("#")]),e._v(" Deployment 的 Scale (up and down)")]),e._v(" "),s("ul",[s("li",[e._v("基本上就是調整 "),s("code",[e._v("replica")]),e._v(" 的數量")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl scale deployment ${DEPLOY_NAME} --replicas=${DEPLOY_NUMBER_COUNT}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("定義解釋")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl explain deployment.spec.replicas\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("Scale up 到 5個replica")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl scale deployment hello --replicas=5\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("觀測一下確定pod有變為5個")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl get pods | grep hello- | wc -l\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("再切為3個")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl scale deployment hello --replicas=3\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"rolling-update"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rolling-update"}},[e._v("#")]),e._v(" Rolling Update")]),e._v(" "),s("ul",[s("li",[e._v("幾本上, 修改Deployment file, k8s就會執行動態 rolling update")]),e._v(" "),s("li",[e._v("修改 deployment.yaml 檔案")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl edit deployment hello\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[s("p",[e._v("改完存檔(如vim), 改完後就會動態生效")])]),e._v(" "),s("li",[s("p",[e._v("看有多少 replicaset")])])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl get replicaset\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("看 rollout history")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl rollout history deployment/hello\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[s("p",[e._v("通用指令")])]),e._v(" "),s("li",[s("p",[s("code",[e._v("kubectl rollout <ACTION> deployment/hello")])])]),e._v(" "),s("li",[s("p",[s("code",[e._v("ACTIONS")]),e._v(":")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("pause")]),e._v(" 暫停")]),e._v(" "),s("li",[s("code",[e._v("status")]),e._v(" 看狀態")]),e._v(" "),s("li",[s("code",[e._v("resume")]),e._v(" 恢復")]),e._v(" "),s("li",[s("code",[e._v("undo")]),e._v(" rollback -> 回滾")]),e._v(" "),s("li",[s("code",[e._v("history")]),e._v(" 看歷史紀錄")])])]),e._v(" "),s("li",[s("p",[e._v("看pod")])])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('kubectl get pods -o jsonpath --template=\'{range .items[*]}{.metadata.name}{"\\t"}{"\\t"}{.spec.containers[0].image}{"\\n"}{end}\'\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"blue-green-deployment-藍綠部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#blue-green-deployment-藍綠部署"}},[e._v("#")]),e._v(" Blue-green deployment 藍綠部署")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("主要是分別建立 blue/green 的 deployment, 由service 來作切換")])]),e._v(" "),s("li",[s("p",[e._v("Rollback -> 就切換部署到上一版")])]),e._v(" "),s("li",[s("p",[e._v("建立綠色部署")])])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl create-f deployments/hello-green.yaml\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("建立藍色部署")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl create-f deployments/hello-blue.yaml\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("Apply (更換過去) -> 切到綠色")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl apply -f services/hello-green.yaml\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("Apply (更換過去) -> 切到藍色")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl apply -f services/hello-blue.yaml\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h3",{attrs:{id:"pipeline-ci-cd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pipeline-ci-cd"}},[e._v("#")]),e._v(" Pipeline (CI/CD)")]),e._v(" "),s("h4",{attrs:{id:"k8s-如何-ci-cd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s-如何-ci-cd"}},[e._v("#")]),e._v(" k8s 如何 CI/CD")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Cloud build / Spinnaker")])]),e._v(" "),s("li",[s("p",[e._v("Cloud build -> jenkins on gcp")])]),e._v(" "),s("li",[s("p",[e._v("Spinnaker -> 可將 code deploy 到 k8s")])]),e._v(" "),s("li",[s("p",[e._v("Jenkins -> 自架 CI/CD infra 怕 fail")])]),e._v(" "),s("li",[s("p",[e._v("Spinnaker -> 包含審核機制")])])]),e._v(" "),s("h4",{attrs:{id:"spinnaker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spinnaker"}},[e._v("#")]),e._v(" Spinnaker")]),e._v(" "),s("ul",[s("li",[e._v("要先用 "),s("code",[e._v("helm")]),e._v(" 將 spinnaker 裝到 "),s("code",[e._v("GKE")]),e._v(" 上面")]),e._v(" "),s("li",[s("code",[e._v("CodeCommit")]),e._v(" -> 推上去, 自動建立一個 contianer image 然後推到ECR")])]),e._v(" "),s("h4",{attrs:{id:"spinnaker-實作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spinnaker-實作"}},[e._v("#")]),e._v(" Spinnaker 實作")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("要先使用 "),s("code",[e._v("helm")]),e._v(" 將 Spinnaker 裝在 GKE 之上")])]),e._v(" "),s("li",[s("p",[e._v("CodeRepo 有改變時 -> 會在 cloud build 先 Run, 跑完之後, GCR會建立一份新的資料")])]),e._v(" "),s("li",[s("p",[e._v("Spinnaker 會先deploy完, 等 manual trigger")])]),e._v(" "),s("li",[s("p",[e._v("需要在 Spinnker 建立 pipeline")])]),e._v(" "),s("li",[s("p",[e._v("cloudbuild -> CI")])]),e._v(" "),s("li",[s("p",[e._v("Spinnaker -> CD")])])]),e._v(" "),s("h5",{attrs:{id:"步驟"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步驟"}},[e._v("#")]),e._v(" 步驟")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("先建立好 GKE cluster")])]),e._v(" "),s("li",[s("p",[e._v("設定好 service account")])]),e._v(" "),s("li",[s("p",[e._v("下載一個 service account key. 當在 SKE 安裝 Spinnaker 時會需要此key")])]),e._v(" "),s("li",[s("p",[e._v("建立 cloud pubsub topic 在 container registry.")])]),e._v(" "),s("li",[s("p",[e._v("建立一個 "),s("code",[e._v("gcr trigger")]),e._v(" 的 subscription")])]),e._v(" "),s("li",[s("p",[e._v("安裝 helm")]),e._v(" "),s("ul",[s("li",[e._v("Helm 是用來安裝和管理 k8s apps")])])])]),e._v(" "),s("h5",{attrs:{id:"k8s-scaling"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s-scaling"}},[e._v("#")]),e._v(" k8s scaling")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("pod auto scaling -> fast")])]),e._v(" "),s("li",[s("p",[e._v("node auto scaling")])]),e._v(" "),s("li",[s("p",[e._v("pod 會不斷增長直到資源用完")])]),e._v(" "),s("li",[s("p",[e._v("Best Practice")])])])])}),[],!1,null,null,null);a.default=t.exports}}]);