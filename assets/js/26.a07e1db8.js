(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{296:function(s,a,e){"use strict";e.r(a);var t=e(13),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"aws-eks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aws-eks"}},[s._v("#")]),s._v(" AWS EKS")]),s._v(" "),e("ul",[e("li",[s._v("AWS 上面的 k8s solution")])]),s._v(" "),e("h3",{attrs:{id:"pre-req"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pre-req"}},[s._v("#")]),s._v(" Pre-req:")]),s._v(" "),e("ul",[e("li",[s._v("AWS credential")]),s._v(" "),e("li",[e("code",[s._v("kubectl")]),s._v(" from k8s(google)")]),s._v(" "),e("li",[e("code",[s._v("eksctl")]),s._v(" from aws")])]),s._v(" "),e("h3",{attrs:{id:"commands"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#commands"}},[s._v("#")]),s._v(" Commands")]),s._v(" "),e("h3",{attrs:{id:"cluster-本體的操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cluster-本體的操作"}},[s._v("#")]),s._v(" Cluster 本體的操作")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("注意 ! 建立 cluster 需要大約 15分鐘左右")])]),s._v(" "),e("li",[e("p",[s._v("建立 EKS Cluster")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("eksctl create cluster \\\n   --name=eksworkshop-eksctl \\ \n   --nodes=3 --alb-ingress-access \n   --region=us-west-2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ul",[e("li",[s._v("刪掉 cluster")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("eksctl delete cluster \\\n   --name=eksworkshop-eksctl \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h4",{attrs:{id:"利用-cluster-yaml-來設定"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#利用-cluster-yaml-來設定"}},[s._v("#")]),s._v(" 利用 "),e("code",[s._v("cluster.yaml")]),s._v(" 來設定")]),s._v(" "),e("ul",[e("li",[s._v("建立")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("eksctl create cluster -f cluster.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("刪除")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("eksctl create cluster -f cluster.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("cluster.yaml 檔案 sample")]),s._v(" "),e("li",[s._v("這是一個 spot Instance group 的設定")])]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" eksctl.io/v1alpha5\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterConfig\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mou"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("region")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" us"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("west"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeGroups")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ng"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("minSize")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxSize")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instancesDistribution")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxPrice")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.017")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instanceTypes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t3.small"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t3.medium"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# At least two instance types should be specified")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("onDemandBaseCapacity")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("onDemandPercentageAboveBaseCapacity")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spotInstancePools")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("ul",[e("li",[s._v("列出 cluster 內的 node group")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("eksctl get nodegroup --cluster=<clusterName>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("查看 node")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl get nodes\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("Deploy k8s dashboard")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("建置到 private cluster, 需要一個 proxy 去存取")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl proxy --port=8080 --address='0.0.0.0' --disable-filter=true &\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"eks-example"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#eks-example"}},[s._v("#")]),s._v(" EKS example")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("├── bin\n├── cluster.yaml\n├── deployment.yaml\n├── loadbalancer.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ul",[e("li",[e("p",[e("code",[s._v("cluster.yaml")])]),s._v(" "),e("ul",[e("li",[s._v("定義Cluster 所需要的Node數量, 機器類型")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("deployment.yaml")])]),s._v(" "),e("ul",[e("li",[s._v("定義Replicas 數量")]),s._v(" "),e("li",[s._v("定義要用的 dockerImage (pod)的功能")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("loadbalancer.yaml")])]),s._v(" "),e("ul",[e("li",[s._v("建立一個Loadbalancer接口, 讓外部可以呼叫")])])]),s._v(" "),e("li",[e("p",[s._v("估計流程會是:\n0. 原先的 app 先建立好 dockerImage")]),s._v(" "),e("ol",[e("li",[s._v("先run "),e("code",[s._v("kubectl create -f cluster.yaml")]),s._v(" 讓EKS叢集起來")]),s._v(" "),e("li",[s._v("再run "),e("code",[s._v("kubectl create -f deployment.yaml")]),s._v(" 讓 container起來, replicaset 也起來")]),s._v(" "),e("li",[s._v("再run "),e("code",[s._v("kubectl create -f loadbalancer.yaml")]),s._v(" 設定一個 loadbalancer 接口")]),s._v(" "),e("li",[s._v("去 該 Loadbalancer, export 特定的 port")]),s._v(" "),e("li",[s._v("最後 browser 就能存取該 loadbalancer 的 entry point.")])])]),s._v(" "),e("li",[e("p",[s._v("修改程式")]),s._v(" "),e("ol",[e("li",[s._v("CI跑完後, 建立一個新的 docker image")]),s._v(" "),e("li",[s._v("去 kubectl 下更新版本")])]),s._v(" "),e("ul",[e("li",[e("code",[s._v("kubectl set image deployment.v1.apps/nginx-deployment nginx=nginx:1.15.4 --record")])]),s._v(" "),e("li",[s._v("kubectl 就會更新版本, 刷新data")])])]),s._v(" "),e("li",[e("p",[s._v("ToDO:")]),s._v(" "),e("ol",[e("li",[s._v("如何連接DB ?")])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);