(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{205:function(a,s,r){"use strict";r.r(s);var t=r(0),e=Object(t.a)({},(function(){var a=this,s=a.$createElement,r=a._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[r("h1",{attrs:{id:"db-系統備份"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#db-系統備份","aria-hidden":"true"}},[a._v("#")]),a._v(" DB 系統備份")]),a._v(" "),r("div",{staticClass:"tip custom-block"},[r("p",[r("strong",[a._v("特別感謝")]),a._v("  此為 "),r("code",[a._v("rainlay")]),a._v(" 大分享技術筆記, 在此感謝! @https://github.com/rainlay")])]),a._v(" "),r("ul",[r("li",[a._v("mysql/mariadb/percona")])]),a._v(" "),r("h4",{attrs:{id:"mysql系-db-分支"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#mysql系-db-分支","aria-hidden":"true"}},[a._v("#")]),a._v(" Mysql系 DB 分支")]),a._v(" "),r("ul",[r("li",[a._v("Mysql (但已被Oracle買下...)")]),a._v(" "),r("li",[a._v("MariaDB (Mysql後的開源fork)")]),a._v(" "),r("li",[a._v("Percona (Mysql的另外一個fork, 有公司營運)")])]),a._v(" "),r("h4",{attrs:{id:"備份方式的說明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#備份方式的說明","aria-hidden":"true"}},[a._v("#")]),a._v(" 備份方式的說明")]),a._v(" "),r("ul",[r("li",[r("p",[a._v("邏輯性備份: 類似 mysqldump")]),a._v(" "),r("ul",[r("li",[a._v("逐項export出來, 類似匯出")]),a._v(" "),r("li",[a._v("需時較久, 資料量一大之後, 很容易Fail")]),a._v(" "),r("li",[a._v("過程中會影響到Prod Database")])])]),a._v(" "),r("li",[r("p",[a._v("物理性備份: 類似 xtrabackup")]),a._v(" "),r("ul",[r("li",[a._v("類似DB檔案直接Copy")]),a._v(" "),r("li",[a._v("需時較短, 較不影響 Prod Database")])])])]),a._v(" "),r("h5",{attrs:{id:"mysqldump"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#mysqldump","aria-hidden":"true"}},[a._v("#")]),a._v(" MysqlDump")]),a._v(" "),r("ul",[r("li",[a._v("待補上")])]),a._v(" "),r("h5",{attrs:{id:"xtrabackup"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#xtrabackup","aria-hidden":"true"}},[a._v("#")]),a._v(" XtraBackup")]),a._v(" "),r("ul",[r("li",[a._v("Percona 所出的一個DB備份功能")]),a._v(" "),r("li",[a._v("物理性備份")])]),a._v(" "),r("h5",{attrs:{id:"mariadb-backup"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#mariadb-backup","aria-hidden":"true"}},[a._v("#")]),a._v(" Mariadb backup")]),a._v(" "),r("ul",[r("li",[a._v("Percona XtraBackup 再 fork 出來的版本")])]),a._v(" "),r("h4",{attrs:{id:"安裝-mariadb-backup"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#安裝-mariadb-backup","aria-hidden":"true"}},[a._v("#")]),a._v(" 安裝 mariadb backup")]),a._v(" "),r("ul",[r("li",[a._v("建議將 MariaDB升到 10.3以上版本")]),a._v(" "),r("li",[a._v("安裝方式")])]),a._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" mariadb-backup\n")])]),a._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[a._v("1")]),r("br")])]),r("h4",{attrs:{id:"完整備份"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#完整備份","aria-hidden":"true"}},[a._v("#")]),a._v(" 完整備份")]),a._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[a._v("mariabackup --user"),r("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("keeper "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n            --password"),r("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("PASSWORD "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n            --backup "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n            --target-dir"),r("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/data/dbbackup/"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[a._v("1")]),r("br"),r("span",{staticClass:"line-number"},[a._v("2")]),r("br"),r("span",{staticClass:"line-number"},[a._v("3")]),r("br"),r("span",{staticClass:"line-number"},[a._v("4")]),r("br")])]),r("ul",[r("li",[a._v("--user 你的DB User")]),a._v(" "),r("li",[a._v("--password 你的DB Password")]),a._v(" "),r("li",[a._v("--backup 使用完整備份")]),a._v(" "),r("li",[a._v("--target-dir 備份資料放置的目錄")])]),a._v(" "),r("h2",{attrs:{id:"還原"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#還原","aria-hidden":"true"}},[a._v("#")]),a._v(" 還原")]),a._v(" "),r("h4",{attrs:{id:"prepare"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#prepare","aria-hidden":"true"}},[a._v("#")]),a._v(" Prepare")]),a._v(" "),r("p",[a._v('回復資料庫之前，需先進行 "Prepare" 的動作')]),a._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 先將 MySQL 停止")]),a._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" mysql stop\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Prepare")]),a._v("\nmariabackup --prepare --target-dir"),r("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/data/dbbackup/\n")])]),a._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[a._v("1")]),r("br"),r("span",{staticClass:"line-number"},[a._v("2")]),r("br"),r("span",{staticClass:"line-number"},[a._v("3")]),r("br"),r("span",{staticClass:"line-number"},[a._v("4")]),r("br"),r("span",{staticClass:"line-number"},[a._v("5")]),r("br")])]),r("h4",{attrs:{id:"restore"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#restore","aria-hidden":"true"}},[a._v("#")]),a._v(" Restore")]),a._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 刪除 mysql 資料庫位置的資料")]),a._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" -r /var/lib/mysql/*\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 還原資料庫")]),a._v("\nmariabackup --copy-back --target-dir"),r("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/data/dbbackup/\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果資料 owner 非 mysql 須改為 mysql 否則會有權限問題")]),a._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" -R mysql:mysql /var/lib/mysql\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 備份完成，啟動　MySQL")]),a._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" mysql start\n")])]),a._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[a._v("1")]),r("br"),r("span",{staticClass:"line-number"},[a._v("2")]),r("br"),r("span",{staticClass:"line-number"},[a._v("3")]),r("br"),r("span",{staticClass:"line-number"},[a._v("4")]),r("br"),r("span",{staticClass:"line-number"},[a._v("5")]),r("br"),r("span",{staticClass:"line-number"},[a._v("6")]),r("br"),r("span",{staticClass:"line-number"},[a._v("7")]),r("br"),r("span",{staticClass:"line-number"},[a._v("8")]),r("br"),r("span",{staticClass:"line-number"},[a._v("9")]),r("br"),r("span",{staticClass:"line-number"},[a._v("10")]),r("br"),r("span",{staticClass:"line-number"},[a._v("11")]),r("br")])]),r("h2",{attrs:{id:"reference"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#reference","aria-hidden":"true"}},[a._v("#")]),a._v(" Reference")]),a._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://mariadb.com/kb/en/library/full-backup-and-restore-with-mariabackup/",target:"_blank",rel:"noopener noreferrer"}},[a._v("mariabackup full-backup"),r("OutboundLink")],1)]),a._v(" "),r("li",[r("a",{attrs:{href:"https://mariadb.com/kb/en/library/mariabackup-options/",target:"_blank",rel:"noopener noreferrer"}},[a._v("mariabackup-options"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);